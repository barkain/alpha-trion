import type { Gender } from "../types";

/**
 * Strip Hebrew niqqud (vowel marks / diacritics) from a string.
 * Niqqud code points range from U+0591 to U+05C7.
 */
function stripNiqqud(text: string): string {
  return text.replace(/[\u0591-\u05C7]/g, "");
}

/** Common female Hebrew first names */
const FEMALE_NAMES = new Set([
  // Classic / biblical
  "שרה", "רבקה", "רחל", "לאה", "מרים", "חנה", "דבורה", "רות",
  "אסתר", "תמר", "דינה", "יעל", "מיכל", "אביגיל", "בתיה",
  "צפורה", "נעמי", "עדנה", "שולמית",

  // Modern popular
  "נועה", "שירה", "דנה", "שני", "ליאת", "מאיה", "אלה", "נגה",
  "הילה", "טליה", "ענבל", "רננה", "גילת", "ליהי", "דניאלה",
  "אורלי", "אורלן", "קרן", "ליאור", "ענת", "עינת", "סיון",
  "אפרת", "גלית", "ורד", "אילנה", "אילת", "אביבה",
  "הדס", "הדסה", "ריקי", "רינה", "אירית", "אורית",
  "יפית", "אורנה", "נורית", "שושנה", "זהבה",
  "נטלי", "טל", "ליאל", "לירון", "לירז", "ליר",
  "שלומית", "מיכאלה", "חגית", "סיגל", "סיגלית",
  "רונית", "דורית", "מירב", "עליזה", "לילך",
  "תהל", "תהלה", "הדר", "שקמה", "אלינור", "אריאלה",
  "יסמין", "מעיין", "קמה", "רוחמה", "אורה",
  "שירן", "מור", "לי", "ים", "אגת", "שיר",
  "צליל", "אלמוג", "הלל", "מילה", "ירדן",
  "עדיה", "נוי", "גאיה", "מיה", "אמה", "עלמה",
  "ספיר", "ניצן", "אביה", "מלכה", "טלי", "יהודית",
  "שרון", "זיו", "פנינה", "נחמה", "בת אל", "בתאל",
  "אדוה", "אלומה", "נצחיה", "ברכה", "אראלה",
  "שילה", "ליבי", "שיראל", "אורטל", "לינוי", "רותי",
  "חן", "עינב", "הגר", "איילת", "אסנת",
  "מיטל", "לימור", "אופיר", "גל", "סתו",
  "אביטל", "ינאי", "רומי",
]);

/** Common male Hebrew first names */
const MALE_NAMES = new Set([
  // Classic / biblical
  "אברהם", "יצחק", "יעקב", "משה", "אהרן", "דוד", "שלמה",
  "שמואל", "יוסף", "בנימין", "יהודה", "גדעון", "שמשון",
  "יהושע", "אליהו", "ישעיהו", "ירמיהו", "עמוס", "יונה",
  "יונתן", "אלעזר", "נחמן",

  // Modern popular
  "דניאל", "יובל", "אורי", "איתן", "עומר", "עידו", "ליאם",
  "איתמר", "אלון", "רועי", "ניר", "גיל", "אמיר", "ארז",
  "תום", "אופק", "יואב", "אייל", "אייר", "נדב",
  "נתן", "נתנאל", "אביב", "אסף", "עמית", "ברק", "מתן",
  "אדם", "אלעד", "אריאל", "בועז", "עדי",
  "דור", "רון", "אילן", "יניב", "גלעד",
  "אוהד", "עמרי", "אבנר", "אורן", "יואל", "צחי",
  "אלי", "מיכאל", "רפאל", "גבריאל", "עידן", "יהונתן",
  "חיים", "מאור", "רז", "שי", "אביחי",
  "עוז", "ליעד", "תומר", "אביתר", "אביעד", "נועם",
  "שגיא", "שגב", "אור", "רותם", "שחר",
  "דביר", "מושון", "אדיר", "אלמוג", "אלקנה",
  "יפתח", "שלו", "מישאל", "ראובן", "שמעון",
  "לוי", "זבולון", "דן", "גד", "אשר", "נפתלי",
  "אורין", "הראל", "עופר", "אמנון", "יותם", "נריה",
  "עמיחי", "רגב", "טל", "סער", "אלדד",
  "בראל", "ליאור", "נוי", "אליאב", "אלירן",
  "יהלי", "לביא", "עילי", "עילאי", "ניצן",
  "אביגדור", "מרדכי", "אפרים", "מנשה",
]);

/**
 * Names that are commonly used for both genders in Israel.
 * These return null (no auto-detection) to let the user pick.
 */
const UNISEX_NAMES = new Set([
  "נועם", "שחר", "עדן", "רותם", "עמית", "אגם",
  "שקד", "רוני", "דרור", "ארבל", "אור", "טל",
  "ליאור", "ניצן", "אלמוג", "נוי", "עדי", "גל",
  "עופר", "סתו",
]);

/**
 * Detect gender from a common Hebrew first name.
 *
 * - Strips niqqud (vowel marks) before matching.
 * - Returns null for unisex names or names not found in either list.
 *
 * @param name - The Hebrew first name (may include niqqud)
 * @returns "male", "female", or null if unrecognized / ambiguous
 */
export function detectGenderFromName(name: string): Gender | null {
  const cleaned = stripNiqqud(name.trim());
  if (!cleaned) return null;

  // Check unisex first (takes priority)
  if (UNISEX_NAMES.has(cleaned)) return null;

  if (FEMALE_NAMES.has(cleaned)) return "female";
  if (MALE_NAMES.has(cleaned)) return "male";

  return null;
}
